services:
    qdrant:
        image: qdrant/qdrant:v1.15.1
        container_name: vector_db
        restart: unless-stopped
        ports:
            - "6333:6333"
            - "6334:6334"
        volumes:
            - qdrant_data:/qdrant/storage
        networks:
            - local
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:6333/healthz"]
            interval: 30s
            timeout: 10s
            retries: 3

    api:
        build:
            context: .
            target: fastapi
        ports: ["8000:8000"]
        env_file: .env
        environment:
            QDRANT_URL: http://qdrant:6333
        networks:
            - local

    chainlit:
        build:
            context: .
            target: chainlit
        ports: ["8001:8001"]
        env_file: .env
        environment:
            QDRANT_URL: http://qdrant:6333
        networks:
            - local

volumes:
    qdrant_data:

networks:
    local:
        driver: bridge
